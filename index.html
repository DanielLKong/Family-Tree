<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Tree</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Trees Sidebar -->
    <aside class="trees-sidebar" id="trees-sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">My Trees</h2>
            <button class="sidebar-close" id="sidebar-close">&times;</button>
        </div>
        <div class="sidebar-content">
            <ul class="trees-list" id="trees-list">
                <!-- Tree items rendered dynamically -->
            </ul>
        </div>
        <div class="sidebar-footer">
            <button class="new-tree-btn" id="new-tree-btn">
                <span class="plus-icon">+</span>
                <span>New Tree</span>
            </button>
            <div class="sidebar-account">
                <button class="account-btn" id="account-btn" title="Account">
                    <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" fill="none" stroke-width="2">
                        <circle cx="12" cy="8" r="4"/>
                        <path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
                    </svg>
                    <span class="account-btn-text" id="account-btn-text">Sign In</span>
                </button>
                <div class="account-dropdown" id="account-dropdown">
                    <div class="account-dropdown-header">
                        <div class="account-dropdown-name" id="account-dropdown-name"></div>
                        <div class="account-dropdown-email" id="account-dropdown-email"></div>
                    </div>
                    <div class="account-dropdown-divider"></div>
                    <button class="account-dropdown-item" id="account-signout-btn">Sign Out</button>
                </div>
            </div>
        </div>
    </aside>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="container">
        <header class="header">
            <button class="sidebar-toggle" id="sidebar-toggle" title="My Trees">
                <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" fill="none" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            </button>
            <span class="header-label">Family Tree</span>
            <h1 class="header-title editable" data-field="title"></h1>
            <p class="header-tagline editable" data-field="tagline"></p>
            <button class="share-btn" id="share-btn" title="Share this tree">
                <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" fill="none" stroke-width="2">
                    <circle cx="18" cy="5" r="3"/>
                    <circle cx="6" cy="12" r="3"/>
                    <circle cx="18" cy="19" r="3"/>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                </svg>
                <span>Share</span>
            </button>
        </header>

        <!-- Tree renders here dynamically from data.js -->
        <main class="tree"></main>

        <!-- Tree controls (zoom + collapse) -->
        <div class="tree-controls">
            <button class="control-btn collapse-all" title="Collapse all">⊟</button>
            <button class="control-btn expand-all" title="Expand all">⊞</button>
            <span class="control-divider"></span>
            <button class="control-btn nickname-toggle active" title="Toggle nicknames">Nicknames</button>
            <span class="control-divider"></span>
            <button class="control-btn zoom-out" title="Zoom out">−</button>
            <span class="zoom-level">100%</span>
            <button class="control-btn zoom-in" title="Zoom in">+</button>
            <button class="control-btn zoom-reset" title="Reset zoom">Reset</button>
        </div>

        <aside class="legend">
            <div class="legend-item">
                <div class="legend-card"></div>
                <span>Blood relative</span>
            </div>
            <div class="legend-item">
                <div class="legend-spouse"></div>
                <span>Spouse info</span>
            </div>
            <div class="legend-item">
                <div class="legend-line"></div>
                <span>Parent → Child</span>
            </div>
        </aside>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal-overlay" id="auth-modal-overlay">
        <div class="auth-modal">
            <button class="auth-modal-close" id="auth-modal-close">&times;</button>
            <h2 class="auth-modal-title" id="auth-modal-title">Sign In</h2>
            <p class="auth-modal-subtitle" id="auth-modal-subtitle">Access your trees from any device</p>

            <form class="auth-form" id="auth-form">
                <input type="email" id="auth-email" placeholder="Email address" required>
                <input type="password" id="auth-password" placeholder="Password" minlength="6">
                <button type="submit" class="auth-submit-btn" id="auth-submit-btn">Sign In</button>
            </form>

            <div class="auth-divider">
                <span>or</span>
            </div>

            <button class="auth-magic-link-btn" id="auth-magic-link-btn">Send Magic Link</button>

            <button class="auth-google-btn" id="auth-google-btn">
                <svg viewBox="0 0 24 24" width="18" height="18">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continue with Google
            </button>

            <p class="auth-toggle-text">
                <span id="auth-toggle-prompt">Don't have an account?</span>
                <button type="button" class="auth-toggle-btn" id="auth-toggle-btn">Sign Up</button>
            </p>
        </div>
    </div>

    <!-- Syncing Overlay -->
    <div class="sync-overlay" id="sync-overlay">
        <div class="sync-spinner"></div>
        <div class="sync-text">Syncing your trees...</div>
    </div>

    <!-- Share Modal -->
    <div class="share-modal-overlay" id="share-modal-overlay">
        <div class="share-modal">
            <button class="share-modal-close" id="share-modal-close">&times;</button>
            <h2 class="share-modal-title">Share this tree</h2>
            <p class="share-modal-subtitle">Anyone with the link can access this tree</p>

            <!-- Create new share link -->
            <div class="share-create-section">
                <div class="share-permission-toggle">
                    <label class="share-permission-option">
                        <input type="radio" name="share-permission" value="viewer" checked>
                        <span class="share-permission-label">
                            <strong>Can view</strong>
                            <span>Look but not edit</span>
                        </span>
                    </label>
                    <label class="share-permission-option">
                        <input type="radio" name="share-permission" value="editor">
                        <span class="share-permission-label">
                            <strong>Can edit</strong>
                            <span>Make changes to the tree</span>
                        </span>
                    </label>
                </div>
                <button class="share-create-btn" id="share-create-btn">Create Link</button>
            </div>

            <!-- Generated link display -->
            <div class="share-link-section" id="share-link-section" style="display: none;">
                <div class="share-link-box">
                    <input type="text" class="share-link-input" id="share-link-input" readonly>
                    <button class="share-copy-btn" id="share-copy-btn">Copy</button>
                </div>
                <p class="share-link-hint" id="share-link-hint"></p>
            </div>

            <!-- Existing shares list -->
            <div class="share-existing-section" id="share-existing-section">
                <h3 class="share-existing-title">Active links</h3>
                <ul class="share-existing-list" id="share-existing-list">
                    <!-- Populated dynamically -->
                </ul>
            </div>

            <!-- Guest prompt (shown if not signed in) -->
            <div class="share-guest-prompt" id="share-guest-prompt" style="display: none;">
                <p>Sign in to share your family tree with others</p>
                <button class="share-signin-btn" id="share-signin-btn">Sign In</button>
            </div>
        </div>
    </div>

    <!-- Load data first, then Supabase config, then app logic -->
    <script src="/data.js"></script>
    <script src="/supabase.js"></script>
    <script src="/app.js"></script>
</body>
</html>

